version: "3.1"

rules:


- rule: greet old user
  condition:
  - active_loop: null
  steps:
    - or:
        - intent: greet
        - intent: greet_alexa
    - action: action_reset_slots
    - action: action_check_profile
    - slot_was_set:
        - check_profile: true
    - action: utter_greet


- rule: greet new user
  condition:
  - active_loop: null
  steps:
    - or:
        - intent: greet
        - intent: greet_alexa
    - action: action_reset_slots
    - action: action_check_profile
    - slot_was_set:
        - check_profile: false
    - action: utter_greet_new_user
    - action: profilejournal
    - active_loop: profilejournal

- rule: fallback
  steps:
  - intent: nlu_fallback
  - action: action_default_fallback

- rule: Say goodbye anytime the user says goodbye
  steps:
  - or:
    - intent: goodbye
    - intent: early_quit
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_goodbye

- rule: Say 'I am a bot' anytime the user challenges
  steps:
  - intent: bot_challenge
  - action: utter_iamabot


- rule: trigger tremor
  condition:
  - active_loop: null
  steps:
  - or:
      - intent: trigger_tremor_mild
      - intent: trigger_tremor_severe
      - intent: trigger_tremor_frequency
      - intent: trigger_tremor_location
      - intent: trigger_current_tremors
  - action: action_set_symptom
  - action: utter_start_journal


- rule: trigger bradykinesia
  condition:
  - active_loop: null
  steps:
  - or:
      - intent: trigger_bradykinesia_1
      - intent: trigger_bradykinesia_2
  - action: action_set_symptom
  - action: utter_start_journal

- rule: trigger dizziness
  condition:
  - active_loop: null
  steps:
  - or:
      - intent: trigger_dizziness
  - action: action_set_symptom
  - action: utter_start_journal

- rule: trigger falling
  condition:
  - active_loop: null
  steps:
  - or:
      - intent: trigger_falling_1
      - intent: trigger_falling_2
  - action: action_set_symptom
  - action: utter_start_journal

- rule: trigger mood
  condition:
  - active_loop: null
  steps:
  - or:
      - intent: trigger_mood_1
      - intent: trigger_mood_2
      - intent: trigger_mood_3
  - action: action_set_symptom
  - action: utter_start_journal

- rule: trigger insomnia
  condition:
  - active_loop: null
  steps:
  - or:
      - intent: trigger_insomnia
  - action: action_set_symptom
  - action: utter_start_journal


- rule: Repeat bot message on user request
  steps:
  - intent: repeat_question
  - action: action_repeat_question

- rule: Simplify previous bot message
  steps:
  - or:
      - intent: user_confused
      - intent: clarify_question
  - action: action_set_simplify
  - action: action_repeat_question
  - action: action_reset_simplify

- rule: User asks for help
  steps:
  - intent: ask_for_help
  - action: utter_propose_help
  - action: action_revert_user_utterance

- rule: User interrupts the chatbot
  steps:
  - intent: interrupt_question
  - action: utter_interrupt_response
  - action: action_revert_user_utterance

- rule: Set slot
  steps:
  - or:
    - intent: activity_dizziness
    - intent: activity_falling
    - intent: activity_both
    - intent: cooccurrence_yes
    - intent: cooccurrence_no
    - intent: inform_cooccurrence
    - intent: daily_activity_yes
    - intent: daily_activity_no
    - intent: daily_activity_unsure
    - intent: inform_dailyactivity
    - intent: duration_1
    - intent: duration_2
    - intent: history_compare_tremor
    - intent: history_compare_dizziness
    - intent: history_compare_deny
    - intent: history_compare_uncertain
    - intent: history_confused_tremor
    - intent: inform_history
    - intent: inform_location_dizziness
    - intent: inform_location_falling
    - intent: inform_location_symptoms
    - intent: inform_location_context
    - intent: inform_location_environment
    - intent: medication_intake
    - intent: affirm_medicine
    - intent: deny_medicine
    - intent: unsure_medicine
    - intent: specify_medicine_type
    - intent: inform_medicine_type
    - intent: medication_time
    - intent: specify_medicine_time
    - intent: inform_medicine_time
    - intent: mood_cause
    - intent: insomnia_cause
    - intent: dizziness_severity
    - intent: falling_severity
    - intent: insomnia_severity
    - intent: inform_time_dizziness
    - intent: inform_time_falling
    - intent: inform_time_symptoms
    - intent: inform_dizziness_severity
    - intent: inform_falling_severity
    - intent: inform_specific_time
    - intent: provide_name
    - intent: provide_age
    - intent: provide_daily_activity
    - intent: provide_years_of_parkinson
    - intent: provide_existing_symptoms
    - intent: provide_daily_challenges
    - intent: provide_prescribed_medications
  - action: action_set_slot

#- rule: Early quit
#  steps:
#  - intent: early_quit
#  - action: utter_goodbye
#  - action: action_reset_slots

- rule: Out of scope
  steps:
  - or:
    - intent: out_of_scope
    - intent: what_can_you_do
  - action: utter_greet_large
  - action: utter_ask_symptom

#- rule: trigger tremor
#  condition:
#  - slot_was_set:
#      - symptom: tremor
#  steps:
#  - action: tremorjournaling
#  - active_loop: tremorjournaling
#
#- rule: trigger bradykinesia
#  condition:
#  - slot_was_set:
#      - symptom: bradykinesia
#  steps:
#  - action: bradykinesiajournaling
#  - active_loop: bradykinesiajournaling
#
#- rule: trigger dizziness
#  condition:
#  - slot_was_set:
#      - symptom: dizziness
#  steps:
#  - action: bradykinesiajournaling
#  - active_loop: bradykinesiajournaling


- rule: Submit tremor form
  condition:
  - active_loop: tremorjournaling
  steps:
  - action: tremorjournaling
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_end_journal
  - action: utter_ask_to_conclude

- rule: Submit bradykinesia form
  condition:
  - active_loop: bradykinesiajournaling
  steps:
  - action: bradykinesiajournaling
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_end_journal
  - action: utter_ask_to_conclude

- rule: Submit dizziness form
  condition:
  - active_loop: dizzinessjournaling
  steps:
  - action: dizzinessjournaling
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_end_journal
  - action: utter_ask_to_conclude

- rule: Submit falling form
  condition:
  - active_loop: fallingjournaling
  steps:
  - action: fallingjournaling
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_end_journal
  - action: utter_ask_to_conclude

- rule: Submit mood form
  condition:
  - active_loop: moodjournaling
  steps:
  - action: moodjournaling
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_end_journal
  - action: utter_ask_to_conclude

- rule: Submit insomnia form
  condition:
  - active_loop: insomniajournaling
  steps:
  - action: insomniajournaling
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_end_journal
  - action: utter_ask_to_conclude

- rule: Submit profile form
  condition:
  - active_loop: profilejournal
  steps:
  - action: profilejournal
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: utter_end_profile_journal
  - action: action_create_user_profile
  - action: utter_ask_symptom